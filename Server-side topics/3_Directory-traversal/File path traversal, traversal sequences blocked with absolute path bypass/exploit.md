# exploit

- Required:

+ This lab contains a [file path traversal](https://portswigger.net/web-security/file-path-traversal) vulnerability in the display of product images.

> The application blocks traversal sequences but treats the supplied filename as being relative to a default working directory.
> 
- Goal:

> + To solve the lab, retrieve the contents of the /etc/passwd file.
> 
- Step:
- Analysis

> + The first step is as usual the analysis of the website. It is a shop website with a few rather interesting products. I recommend reading the product descriptions.
> 
> 
> + The page references the products images as file names, indicating a possible path traversal vulnerability
> 
> ![exploit%20a337532772dd4638ba64a1cbfc26c5f9/image1.png](exploit%20a337532772dd4638ba64a1cbfc26c5f9/image1.png)
> 
> + As described in the lab description, simply requesting ../../../etc/passwd dose not lead to any file.
> 
> ![exploit%20a337532772dd4638ba64a1cbfc26c5f9/image2.png](exploit%20a337532772dd4638ba64a1cbfc26c5f9/image2.png)
> 
> + The hint of lab description, ‘filenames are treated as relative to a default working directory’, could be interpreted in different ways:
> 
> ![exploit%20a337532772dd4638ba64a1cbfc26c5f9/image3.png](exploit%20a337532772dd4638ba64a1cbfc26c5f9/image3.png)
> 
1. Default as defined within the applications:

> The application prepends this default working directory to the requested filename before trying to access the file
> 
1. Default as defined by the web server:

> Alternatively, the application could rely on the fact that the execution of file system activities will always happen in the 'default working directory' of the webserver if no path is given. So when requesting 64.jpg, which by itself is no path, it will assume the path of /image to look for the file
> 
- I rule out the first one as this would allow simple path traversals which are not possible. Thus assuming it is the second interpretation then providing an absolute path may be the solution.
- The malicious payload

> + So I load the page and send one of the image requests to Burp Repeater. If you don't see it in the HTTP history, check if images are filtered out in the filter bar (by default it is hidden):
> 
> 
> ![exploit%20a337532772dd4638ba64a1cbfc26c5f9/image4.png](exploit%20a337532772dd4638ba64a1cbfc26c5f9/image4.png)
> 
> + Now I request the /etc/passwd with its absolute path:
> 
> ![exploit%20a337532772dd4638ba64a1cbfc26c5f9/image5.png](exploit%20a337532772dd4638ba64a1cbfc26c5f9/image5.png)
>