# exploit

- Require the lab:
- This lab allows users to stay logged in even after they close their browser session. The cookie used to provide this functionality is vulnerable to brute-forcing.
- Goal:
- To solve the lab, brute-force Carlos's cookie to gain access to his "My account" page.

> + Your credentials: wiener:peter
> 
> 
> + Victim's username: carlos
> 
> + [Candidate passwords](https://portswigger.net/web-security/authentication/auth-lab-passwords)
> 
- Step:
- Analyze cookie
    
    + As usual, the initial step is to analyze the login and 'stay-login' process. As such, I log in with the known credentials of the user wiener. In the response, a cookie is set that catches the eye:
    
    ![exploit%2085b9afe483a64a6593bf5979677f5d4d/image1.png](exploit%2085b9afe483a64a6593bf5979677f5d4d/image1.png)
    
    + Using Burp Suite, it immediately shows the decoded value in the Inspector:
    
    ![exploit%2085b9afe483a64a6593bf5979677f5d4d/image2.png](exploit%2085b9afe483a64a6593bf5979677f5d4d/image2.png)
    
    + It can be seem that the username is part of the cookie. If I can guess the second part correctly for a user it becomes possible to create valid cookies for that users. The second part look like a hash and is 32 characters long, which lets me think md5. Let’s see if it is a simple md5 of the username (which would be a really fatal as no password would be required) or the password. Then I copy it and paste it to crash hash online.
    
    ![exploit%2085b9afe483a64a6593bf5979677f5d4d/image3.png](exploit%2085b9afe483a64a6593bf5979677f5d4d/image3.png)
    
    + And finally, the second part is an md5 hash of password.
    
- Brute force the cookie
    
    + I send the request for the account page to Burp Intruder, setting the stay-logged-in cookies as the payload
    
    ![exploit%2085b9afe483a64a6593bf5979677f5d4d/image4.png](exploit%2085b9afe483a64a6593bf5979677f5d4d/image4.png)
    
    ![exploit%2085b9afe483a64a6593bf5979677f5d4d/image5.png](exploit%2085b9afe483a64a6593bf5979677f5d4d/image5.png)
    
    + For each password, I hash it, add the username in front and base64-encode everything. I also set on the options page a matching rule to quickly see if I am logged in as user carlos:
    
    ![exploit%2085b9afe483a64a6593bf5979677f5d4d/image6.png](exploit%2085b9afe483a64a6593bf5979677f5d4d/image6.png)
    

+ Then we click Star Attack and wait for it to work

![exploit%2085b9afe483a64a6593bf5979677f5d4d/image7.png](exploit%2085b9afe483a64a6593bf5979677f5d4d/image7.png)

+ We will have two line with the same length. One of them is the username winer, another is the carlos.

![exploit%2085b9afe483a64a6593bf5979677f5d4d/image8.png](exploit%2085b9afe483a64a6593bf5979677f5d4d/image8.png)

+ We continue send it to decoder and hash it. Finally, we will have the password of carlos.