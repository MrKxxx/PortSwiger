# exploit

- Require of lab:

> + This lab contains a DOM-based cross-site scripting vulnerability on the home page. It uses jQuery's $() selector function to auto-scroll to a given post, whose title is passed via the location.hash property.
> 
- Goal:
    
    + To solve the lab, deliver an exploit to the victim that calls the print() function in their browser.
    
- Steps:
- Analysis:
    
    + The first step is to analyse the web application. An interesting script can be found at the bottom of the page
    
    ![exploit%20317de60badce443c895dfd856034ed12/image1.png](exploit%20317de60badce443c895dfd856034ed12/image1.png)
    
    + A quick check in some [online documentation](https://developer.mozilla.org/en-US/docs/Web/API/Window/hashchange_event) shows that the script is used to scroll to a post indicated by the fragment part of the URL. Using the title of a post after a #, the browser scrolls to the post.
    
    ![exploit%20317de60badce443c895dfd856034ed12/image2.png](exploit%20317de60badce443c895dfd856034ed12/image2.png)
    
- Creating an exploit
    
    + So I can use content from the URL to trigger an error. If I am able to also inject an onerror handler, than I can call any command I want.
    
    + Fortunately there is the exploit server that I can use to prepare and deliver a custom made page. So I can create a page including an iframe to the vulnerable page. With an onload event I change the fragment which in turn triggers the hashchange event.
    
    + As a first step I try to trigger an error with this payload:
    

> <iframe src=linkweb/# onload="this.src+='xxx'"></iframe>
> 

+ It also shows an error similar to the one shown in the previous section.

+ Unfortunately, I can not simply attach an onerror handler on the iframe, I guess because of differing origins of the page itself (exploit server) and the iframe.

+ Instead, I try to inject an img tag with an invalid source and local onerror handler:

> <iframe src="https://ac8a1f4d1e3d1aa3c06b541e0003009a.web-security-academy.net/#" onload="this.src+='<img src=xxx onerror=alert(document.location)>'"></iframe>
> 
> 
> + This causes the post variable to evaluate to a single image object and shows the alert box confirming that the script triggers on the main domain
> 
> ![exploit%20317de60badce443c895dfd856034ed12/image3.png](exploit%20317de60badce443c895dfd856034ed12/image3.png)
> 
- Exploit
    
    + Now it is simple: Changing the error handler to call print and deliver the exploit to the victim: