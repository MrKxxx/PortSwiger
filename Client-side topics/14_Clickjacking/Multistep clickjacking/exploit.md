# exploit

- Require of lab:

> + This lab has some account functionality that is protected by a CSRF token and also has a confirmation dialog to protect against Clickjacking.
> 
> 
> + You can log in to the account yourself using the following credentials: wiener:peter
> 
- Goal:
    
    + To solve this lab construct an attack that fools the user into clicking the delete account button and the confirmation dialog by clicking on "Click me first" and "Click me next" decoy actions. You will need to use two elements for this lab.
    
- Steps:
- Analysis:

> +  The targeted functionality is an authenticated one, so I log into the account of wiener to have a look
> 
> 
> + The account page features a prominent Delete account button.
> 
> ![exploit%20f834575202ee4678b4009a45f67c30e0/image1.png](exploit%20f834575202ee4678b4009a45f67c30e0/image1.png)
> 
> + Once I click on it, an additional dialog is shown:
> 
> ![exploit%20f834575202ee4678b4009a45f67c30e0/image2.png](exploit%20f834575202ee4678b4009a45f67c30e0/image2.png)
> 
> + The requests are very similar:
> 
> ![exploit%20f834575202ee4678b4009a45f67c30e0/image3.png](exploit%20f834575202ee4678b4009a45f67c30e0/image3.png)
> 
> + Two obvious options are not possible here:
> 
- I cannot manipulate the form itself, otherwise, it would be easy to skip the second check by adding the confirmed value to the form.
- The CSRF token prevents me from trying to issue the delete requests directly in an iframe. Furthermore, the /my-account/delete endpoint is not accessible with GET requests so can't be directly loaded into an iframe.

> + So I need to convince the user to click twice. In real life, knowing common user behaviour will be important to convince them not only to click but also the order of clicks. Knowing as much about my victim (or victim group) is key here - some are triggered by cars, others I can get rage-clicking by using politics, and for some audiences, nudes are always best.
> 
- Craft the malicious HTML
    
    + I have the information that the user clicks on anything that tells him to click. My victim user even obeys the order I tell him to click.
    
    So that is exactly what I'll do:
    
    ![exploit%20f834575202ee4678b4009a45f67c30e0/image4.png](exploit%20f834575202ee4678b4009a45f67c30e0/image4.png)
    
    + This renders the page with two Click me fields, the first perfectly overlays the Delete account button
    
    ![exploit%20f834575202ee4678b4009a45f67c30e0/image5.png](exploit%20f834575202ee4678b4009a45f67c30e0/image5.png)
    
    + whereas the next does the same for the confirmation
    
    ![exploit%20f834575202ee4678b4009a45f67c30e0/image6.png](exploit%20f834575202ee4678b4009a45f67c30e0/image6.png)
    
- After reducing the opacity to 0.000, Store and Deliver exploit to victim, the lab updates to